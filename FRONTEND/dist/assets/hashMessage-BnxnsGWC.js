import{H as u,J as $,ai as c,O as b,Q as I,aj as x,ak as z,D as k,al as H,am as O,an as j,ao as y,ap as A,aq as l,ar as N}from"./index-CNwFkfGV.js";class B extends u{constructor({domain:t}){super(`Invalid domain "${$(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class C extends u{constructor({primaryType:t,types:n}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(n))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class R extends u{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function U(e){const{domain:t={},message:n,primaryType:r}=e,s={EIP712Domain:q({domain:t}),...e.types};V({domain:t,message:n,primaryType:r,types:s});const a=["0x1901"];return t&&a.push(W({domain:t,types:s})),r!=="EIP712Domain"&&a.push(T({data:n,primaryType:r,types:s})),c(b(a))}function W({domain:e,types:t}){return T({data:e,primaryType:"EIP712Domain",types:t})}function T({data:e,primaryType:t,types:n}){const r=E({data:e,primaryType:t,types:n});return c(r)}function E({data:e,primaryType:t,types:n}){const r=[{type:"bytes32"}],s=[F({primaryType:t,types:n})];for(const a of n[t]){const[i,p]=v({types:n,name:a.name,type:a.type,value:e[a.name]});r.push(i),s.push(p)}return I(r,s)}function F({primaryType:e,types:t}){const n=x(J({primaryType:e,types:t}));return c(n)}function J({primaryType:e,types:t}){let n="";const r=D({primaryType:e,types:t});r.delete(e);const s=[e,...Array.from(r).sort()];for(const a of s)n+=`${a}(${t[a].map(({name:i,type:p})=>`${p} ${i}`).join(",")})`;return n}function D({primaryType:e,types:t},n=new Set){const s=e.match(/^\w*/u)?.[0];if(n.has(s)||t[s]===void 0)return n;n.add(s);for(const a of t[s])D({primaryType:a.type,types:t},n);return n}function v({types:e,name:t,type:n,value:r}){if(e[n]!==void 0)return[{type:"bytes32"},c(E({data:r,primaryType:n,types:e}))];if(n==="bytes")return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},c(r)];if(n==="string")return[{type:"bytes32"},c(x(r))];if(n.lastIndexOf("]")===n.length-1){const s=n.slice(0,n.lastIndexOf("[")),a=r.map(i=>v({name:t,type:s,types:e,value:i}));return[{type:"bytes32"},c(I(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:n},r]}function V(e){const{domain:t,message:n,primaryType:r,types:s}=e,a=(i,p)=>{for(const w of i){const{name:P,type:d}=w,o=p[P],m=d.match(z);if(m&&(typeof o=="number"||typeof o=="bigint")){const[S,f,M]=m;k(o,{signed:f==="int",size:Number.parseInt(M)/8})}if(d==="address"&&typeof o=="string"&&!H(o))throw new O({address:o});const h=d.match(j);if(h){const[S,f]=h;if(f&&y(o)!==Number.parseInt(f))throw new A({expectedSize:Number.parseInt(f),givenSize:y(o)})}const g=s[d];g&&(Q(d),a(g,o))}};if(s.EIP712Domain&&t){if(typeof t!="object")throw new B({domain:t});a(s.EIP712Domain,t)}if(r!=="EIP712Domain")if(s[r])a(s[r],n);else throw new C({primaryType:r,types:s})}function q({domain:e}){return[typeof e?.name=="string"&&{name:"name",type:"string"},e?.version&&{name:"version",type:"string"},(typeof e?.chainId=="number"||typeof e?.chainId=="bigint")&&{name:"chainId",type:"uint256"},e?.verifyingContract&&{name:"verifyingContract",type:"address"},e?.salt&&{name:"salt",type:"bytes32"}].filter(Boolean)}function Q(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new R({type:e})}const G=`Ethereum Signed Message:
`;function K(e){const t=typeof e=="string"?l(e):typeof e.raw=="string"?e.raw:N(e.raw),n=l(`${G}${y(t)}`);return b([n,t])}function X(e,t){return c(K(e),t)}export{U as a,X as h};
